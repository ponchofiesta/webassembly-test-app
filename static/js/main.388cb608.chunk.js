(this["webpackJsonpwebassembly-test-app"]=this["webpackJsonpwebassembly-test-app"]||[]).push([[0],{192:function(e,t,a){e.exports=a(342)},341:function(e,t,a){},342:function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(41),o=a.n(n),i=a(180),l=a(37),c=a(346),h=a(347),d=a(355),m=a(352),p=a(348);var u=class{constructor(){this.startTime=null,this.stopTime=null,this.result=null,this.onLoad=()=>{}}start(){this.startTime=performance.now()}stop(){this.stopTime=performance.now(),this.result=this.stopTime-this.startTime}results(){return this.result}};var w=class extends u{sort(e){return e.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0)}run(e){console.debug("start "+this.constructor.name);let t=JSON.parse(JSON.stringify(e.externalData.data));super.start(),this.sort(t),super.stop(),console.debug("stop "+this.constructor.name)}};var g=a(112);var v=class extends u{aes_encrypt(e,t,a){return new g.ModeOfOperation.cbc(e,t).encrypt(a)}aes_decrypt(e,t,a){return new g.ModeOfOperation.cbc(e,t).decrypt(a)}run(e){console.debug("start "+this.constructor.name),super.start(),this.aes_encrypt(...e.parameters,e.externalData.data),super.stop(),console.debug("stop "+this.constructor.name)}},y=a(169),b=a.n(y);var f=class extends u{deflate(e){return b.a.deflate(e,{raw:!0})}run(e){console.debug("start "+this.constructor.name),super.start(),this.deflate(e.externalData.data),super.stop(),console.debug("stop "+this.constructor.name)}},x=a(81);var E=class extends u{constructor(...e){super(...e),this.image=null,this.canvas=null,this.context=null,this.onDraw=()=>{}}async run(e){console.debug("start "+this.constructor.name),this.image=e.externalData.data,this.canvas=document.createElement("canvas"),this.canvas.width=this.image.width,this.canvas.height=this.image.height,this.context=this.canvas.getContext("2d"),this.context.drawImage(this.image,0,0),await this.onLoad(Object(x.a)({},e,{canvas:this.canvas})),super.start(),this.onDraw(),super.stop(),console.debug("stop "+this.constructor.name)}};var k=class extends E{constructor(){super(),this.convoluteFilter=(e,t,a,s,r)=>{const n=Math.round(Math.sqrt(s.length)),o=Math.floor(n/2),i=new Uint8ClampedArray(t*a*4);for(let l=0;l<a;l++)for(let c=0;c<t;c++){const h=4*(l*t+c);let d=0,m=0,p=0;for(let r=0;r<n;r++)for(let i=0;i<n;i++){const h=l+r-o,u=c+i-o;if(h>=0&&h<a&&u>=0&&u<t){const a=4*(h*t+u),o=s[r*n+i];d+=e[a]*o,m+=e[a+1]*o,p+=e[a+2]*o}}i[h]=d*r,i[h+1]=m*r,i[h+2]=p*r,i[h+3]=e[h+3]}return i},super.onDraw=()=>{const e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);e.data.set(this.convolve(e.data,this.canvas.width,this.canvas.height)),this.context.putImageData(e,0,0)}}convolve(e,t,a){return this.convoluteFilter(e,t,a,[0,.2,0,.2,.2,.2,0,.2,0],1)}};var D=class extends E{constructor(){super(),super.onDraw=()=>{const e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);e.data.set(window.wasm.rust.convolve_mem(e.data,this.canvas.width,this.canvas.height)),this.context.putImageData(e,0,0)}}};var C=class extends u{constructor(e){super();const t=typeof e;if("function"!==t)throw new Error("method parameter must be a function, actually it is '"+t+"'.");this.method=e}run(e){console.debug("start "+this.constructor.name),super.start(),this.method(e),super.stop(),console.debug("stop "+this.constructor.name)}};var I=class extends u{constructor(...e){super(...e),this.canvas=null,this.context=null,this.video=null,this.frameCount=0,this.onDraw=null,this.onEnd=e=>{super.stop(),console.debug("stop "+this.constructor.name),e()},this.getVideoFrame=()=>{const e=document.createElement("canvas");e.width=this.video.videoWidth,e.height=this.video.videoHeight;const t=e.getContext("2d");return t.drawImage(this.video,0,0,e.width,e.height),t.getImageData(0,0,e.width,e.height)},this.renderVideo=()=>{this.onDraw(),this.video.paused||requestAnimationFrame(this.renderVideo)}}async run(e){console.debug("start "+this.constructor.name),this.video=e.externalData.data,this.video.style="display: none;";const t=document.createElement("canvas");t.width=this.video.videoWidth,t.height=this.video.videoHeight,this.canvas=t,this.context=t.getContext("2d"),await this.onLoad(Object(x.a)({},e,{video:e.externalData.data,canvas:t}));const a=new Promise((e,t)=>{this.video.addEventListener("ended",()=>{this.onEnd(e)},!1),this.video.addEventListener("error",()=>{this.onEnd(t)},!1)});return super.start(),this.video.play(),this.renderVideo(),a}results(){return this.result=this.frameCount/(this.stopTime-this.startTime)*1e3,this.result}};var S=class extends I{constructor(){super(),super.onDraw=()=>{let e=this.getVideoFrame();e.data.set(this.convolve(e.data,this.video.videoWidth,this.video.videoHeight,[[1,1,1],[1,1,1],[1,1,1]],1/9,6)),this.context.putImageData(e,0,0),this.frameCount++}}convolve(e,t,a,s,r,n=1){const o=s.length,i=Math.floor(o/2);for(let l=0;l<n;l+=1)for(let n=1;n<a-1;n+=1)for(let a=1;a<t-1;a+=1){const l=4*(n*t+a);let c=0,h=0,d=0;for(let r=0;r<o;++r)for(let l=0;l<o;++l){const o=4*((n+(r-i))*t+(a+(l-i)));c+=e[o]*s[r][l],h+=e[o+1]*s[r][l],d+=e[o+2]*s[r][l]}e[l]=r*c,e[l+1]=r*h,e[l+2]=r*d}return e}};var A=class extends I{constructor(){super(),super.onDraw=()=>{let e=this.getVideoFrame();e.data.set(this.convolve(e.data,this.video.videoWidth,this.video.videoHeight)),this.context.putImageData(e,0,0),this.frameCount++}}convolve(e,t,a){return window.wasm.rust.convolve_video(e,this.video.videoWidth,this.video.videoHeight,1/9,6)}};var j=a(78),H=a.n(j);var T=class extends u{sha256(e){const t=H.a.md.sha256.create();return t.update(e),t.digest().toHex()}run(e){console.debug("start "+this.constructor.name);let t="";e.externalData.data.forEach(e=>t+=String.fromCharCode(e)),this.start(),this.sha256(t),this.stop(),console.debug("stop "+this.constructor.name)}};var B=class extends u{dom(e){const t=document.body,a=document.createElement("div");t.appendChild(a);for(let s=0;s<e;s++){const e=document.createElement("h3");e.textContent="Header "+s;const t=document.createElement("p");t.textContent="Paragraph "+s,a.appendChild(e),a.appendChild(t)}t.removeChild(a)}run(e){console.debug("start "+this.constructor.name),super.start(),this.dom(...e.parameters),super.stop(),console.debug("stop "+this.constructor.name)}};var L=class extends u{async sha256(e){const t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(e=>("00"+e.toString(16)).slice(-2)).join("")}async run(e){console.debug("start "+this.constructor.name),this.start(),await this.sha256(e.externalData.data.buffer),this.stop(),console.debug("stop "+this.constructor.name)}};var M=class extends u{async sha512(e){const t=await crypto.subtle.digest("SHA-512",e);return Array.from(new Uint8Array(t)).map(e=>("00"+e.toString(16)).slice(-2)).join("")}async run(e){console.debug("start "+this.constructor.name),this.start(),await this.sha512(e.externalData.data.buffer),this.stop(),console.debug("stop "+this.constructor.name)}};var P=class extends u{sha512(e){const t=H.a.md.sha512.create();return t.update(e),t.digest().toHex()}run(e){console.debug("start "+this.constructor.name);let t="";e.externalData.data.forEach(e=>t+=String.fromCharCode(e)),this.start(),this.sha512(e.externalData.data),this.stop(),console.debug("stop "+this.constructor.name)}},O=a(108),R=a.n(O);var _=class extends u{run(e){console.debug("start "+this.constructor.name),super.start(),R.a.fromByteArray(e.externalData.data),super.stop(),console.debug("stop "+this.constructor.name)}};var F=class extends u{run(e){console.debug("start "+this.constructor.name);let t="";for(let a=0;a<e.externalData.data.length;a++)t+=String.fromCharCode(e.externalData.data[a]);super.start();btoa(t);super.stop(),console.debug("stop "+this.constructor.name)}};const W=e=>{let t=0;return e<1?t=3:e<10?t=2:e<100&&(t=1),e.toFixed(t)},V=e=>W(e)+" fps",U={chart:{width:"100%",height:16,type:"line",animations:{enabled:!1}},markers:{size:7},dataLabels:{enabled:!0,formatter:W},xaxis:{title:{text:"Iterations"},categories:[]},yaxis:{title:{text:"Duration in ms"},labels:{formatter:W}},legend:{show:!0},title:{text:"Time taken to run the benchmarks",align:"left"},tooltip:{y:{formatter:e=>W(e)+" ms"}}};var K={players:{js:{logo:"logos/es-ecmascript-logo.svg",color:"rgb(248,220,61)",type:"js"},rust:{logo:"logos/rust-logo-blk.svg",color:"black",type:"wasm"}},benchmarksets:[{name:"Base64",description:"Calculate Base64 string representation",benchmarks:[{name:"base64 btoa()",player:"js",newInstance:()=>new F},{name:"base64",player:"js",newInstance:()=>new _},{name:"base64",player:"rust",newInstance:()=>new C(e=>window.wasm.rust.base64(e.externalData.data))},{name:"base64 prepared",player:"rust",newInstance:()=>new C(e=>window.wasm.rust.base64_prepared())}],parameters:[],externalData:{type:"bytes",path:"data/random1K.bin",repeat:1e3},repeat:20,chart:U,result:[],error:null},{name:"Sort",description:"Sort a list of elements containing multiple fields",benchmarks:[{name:"Sort",player:"js",newInstance:()=>new w},{name:"Sort",player:"rust",newInstance:()=>new C(e=>window.wasm.rust.sort(...e.parameters))}],parameters:[],externalData:{type:"sort",path:"data/users1000.json",repeat:100},repeat:20,chart:U,result:[],error:null},{name:"SHA256",description:"Calculate the SHA256 hash",benchmarks:[{name:"sha256 Forge",player:"js",newInstance:()=>new T},{name:"sha256 Crypto API",player:"js",newInstance:()=>new L},{name:"sha256",player:"rust",newInstance:()=>new C(e=>window.wasm.rust.sha256(e.externalData.data))},{name:"sha256 data prepared",player:"rust",newInstance:()=>new C(e=>window.wasm.rust.sha256_prepared())}],parameters:[],externalData:{type:"bytes",path:"data/random1K.bin",repeat:1e3},repeat:20,chart:U,result:[],error:null},{name:"SHA512",description:"Calculate the SHA512 hash",benchmarks:[{name:"sha512 Forge",player:"js",newInstance:()=>new P},{name:"sha512 Crypto API",player:"js",newInstance:()=>new M},{name:"sha512",player:"rust",newInstance:()=>new C(e=>window.wasm.rust.sha512(e.externalData.data))}],parameters:[],externalData:{type:"bytes",path:"data/random1K.bin",repeat:1e3},repeat:20,chart:U,result:[],error:null},{name:"Encryption",description:"Encrypt data using AES",benchmarks:[{name:"AES CBC",player:"js",newInstance:()=>new v},{name:"AES CBC",player:"rust",newInstance:()=>new C(e=>window.wasm.rust.aes(e.externalData.data))}],parameters:[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],[17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]],externalData:{type:"bytes",path:"data/random1K.bin",repeat:1e3},repeat:20,chart:U,result:[],error:null},{name:"Compression",description:"Compress data using Deflate",benchmarks:[{name:"Deflate",player:"js",newInstance:()=>new f},{name:"Deflate",player:"rust",newInstance:()=>new C(e=>window.wasm.rust.deflate(e.externalData.data))},{name:"Deflate prepared",player:"rust",newInstance:()=>new C(()=>window.wasm.rust.deflate_prepared())}],parameters:[],externalData:{type:"bytes",path:"data/random1K.bin",repeat:1e3},repeat:20,chart:U,result:[],error:null},{name:"Convolution filter",description:"Manipulate an image using a convolution filter",benchmarks:[{name:"convolve",player:"js",newInstance:()=>new k},{name:"convolve",player:"rust",newInstance:()=>new D}],parameters:[],externalData:{type:"image",path:"data/photo.jpg",repeat:1},repeat:20,chart:U,showCanvas:!0,canvas:null,result:[],error:null},{name:"Video filter",description:"Manipulate a video using a convolution filter",benchmarks:[{name:"convolve video",player:"js",newInstance:()=>new S},{name:"convolve video",player:"rust",newInstance:()=>new A}],parameters:[],externalData:{type:"video",path:"data/flowers.mp4",repeat:1},repeat:1,chart:{chart:{width:"100%",height:300,type:"bar",animations:{enabled:!1}},markers:{size:7},dataLabels:{enabled:!0,formatter:V},xaxis:{title:{text:"Iterations"},categories:[]},yaxis:{title:{text:"Frames per second"},labels:{formatter:V}},legend:{show:!0},title:{text:"Frame rate",align:"left"},tooltip:{y:{formatter:V}}},showCanvas:!0,canvas:null,video:null,result:[],error:null},{name:"DOM manipulation",description:"Create, add and remove nodes to the documents DOM tree",benchmarks:[{name:"dom",player:"js",newInstance:()=>new B},{name:"dom",player:"rust",newInstance:()=>new C(e=>window.wasm.rust.dom(...e.parameters))}],parameters:[1e3],repeat:20,chart:U,showCanvas:!0,canvas:null,video:null,result:[],error:null}]};const z=async e=>{let t=null;if(e){let s;if("image"===e.type?s=new Image:"video"===e.type&&(s=document.createElement("video")),["image","video"].includes(e.type))t=await((e,t)=>{return new Promise((a,s)=>{if(t instanceof HTMLImageElement)t.addEventListener("load",e=>{a(t)},!1),t.src=e;else{if(!(t instanceof HTMLVideoElement))throw new Error("Invalid media type "+typeof t);t.addEventListener("loadeddata",e=>{a(t)},!1),t.src=e,t.load()}t.addEventListener("error",e=>{s(e)},!1)})})(e.path,s);else if("bytes"===e.type){let a=await fetch(e.path),s=await a.arrayBuffer();t=new Uint8Array(s)}else{let s=await fetch(e.path);try{t=await s.clone().json()}catch(a){t=await s.text()}}if(e&&e.repeat>1)if(t instanceof Uint8Array){let a=new Uint8Array(e.repeat*t.length);for(let s=0;s<e.repeat;s++)a.set(t,s*t.length);t=a}else t="object"==typeof t?Array(e.repeat).fill(t).flat():String(t).repeat(e.repeat)}return null!==t&&(e.data=t),e},J=(e,t,a)=>{e&&["bytes","sort"].includes(e.type)&&Object.keys(K.players).forEach(s=>{if("wasm"===K.players[s].type&&t.some(e=>e.player===s))switch(a){case"prepare":window.wasm[s].prepare_test_data(e.type,e.data);break;case"reset":window.wasm[s].reset_test_data(e.type);break;case"clear":window.wasm[s].clear_test_data(e.type)}}),e&&"clear"===a&&(e.data=null)},q=(e,t)=>J(e,t,"reset"),N=async(e,t)=>{await z(e.externalData),((e,t)=>J(e,t,"prepare"))(e.externalData,e.benchmarks);let a=[],s=[],r=[];for(let n=0;n<e.benchmarks.length;n++){const t=e.benchmarks[n];r.push(K.players[t.player].color);for(let r=0;r<e.repeat;r++)a.length<e.repeat&&a.push(r+1),s[n]||(s[n]={name:t.player+": "+t.name,data:[]})}for(let n=0;n<e.benchmarks.length;n++){const a=e.benchmarks[n];for(let r=0;r<e.repeat;r++){q(e.externalData,e.benchmarks);let r=a.newInstance();r.onLoad=t,await r.run(e),s[n].data.push(r.results())}}return((e,t)=>J(e,t,"clear"))(e.externalData,e.benchmarks),{categories:a,series:s,colors:r}};var $=a(353),G=a(349),Q=a(183),X=a(350),Y=a(351),Z=a(170),ee=a.n(Z);class te extends s.Component{fitToParent(e){const t=e.parentElement.clientWidth/e.width;t>1||(e.style.width=e.parentElement.clientWidth+"px",e.style.height=t*e.height+"px")}setMediaElement(e,t){e&&(e.innerHTML="",e.appendChild(t),this.fitToParent(t),window.addEventListener("resize",()=>this.fitToParent(t),!1))}seriesAvg(e){return e.map(e=>({name:e.name,avg:e.data.reduce((e,t)=>e+t,0)/e.data.length}))}render(){return r.a.createElement($.a,null,r.a.createElement(d.a,{as:"h2",floated:"left"},this.props.name,r.a.createElement(d.a.Subheader,null,this.props.description)),r.a.createElement(m.a,{circular:!0,basic:!0,color:"teal",icon:"play circle",content:"Run",floated:"right",onClick:()=>this.props.onRun(this.props),disabled:this.props.someRunning,loading:this.props.running}),r.a.createElement(d.a,{as:"h3",style:{clear:"both"}},"Benchmarks"),r.a.createElement(G.a,{horizontal:!0,divided:!0},this.props.benchmarks.map(e=>r.a.createElement(G.a.Item,{key:e.name+"-"+e.player},r.a.createElement(Q.a,{avatar:!0,src:K.players[e.player].logo,alt:e.player}),r.a.createElement(G.a.Content,null,r.a.createElement(G.a.Header,null,e.name))))),this.props.canvas?r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{as:"h3"},"Canvas"),r.a.createElement("div",{ref:e=>this.setMediaElement(e,this.props.canvas)}),this.props.video?r.a.createElement("div",{ref:e=>this.setMediaElement(e,this.props.video)}):null):null,this.props.series&&this.props.series[0].data.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{as:"h3"},"Results"),r.a.createElement(ee.a,Object.assign({options:this.props.chart,series:this.props.series},this.props.chart.chart,{height:"300"})),r.a.createElement(X.a,{definition:!0,celled:!0},r.a.createElement(X.a.Header,null,r.a.createElement(X.a.Row,null,r.a.createElement(X.a.HeaderCell,null),this.props.series.map(e=>r.a.createElement(X.a.HeaderCell,{key:e.name},e.name)))),r.a.createElement(X.a.Body,null,r.a.createElement(X.a.Row,null,r.a.createElement(X.a.Cell,null,"Average"),this.seriesAvg(this.props.series).map(e=>r.a.createElement(X.a.Cell,{key:e.name},W(e.avg))))))):null,this.props.error?r.a.createElement(Y.a,{error:!0,header:"Some benchmarks had errors",content:this.props.error instanceof Error?this.props.error.stack:this.props.error}):null)}}var ae=te;class se extends s.Component{constructor(e){super(e),this.setStatePromise=e=>new Promise(t=>{this.setState(e,()=>{setTimeout(()=>t(),1)})}),this.onRunAllBenchmarksets=async()=>{await this.setStatePromise({running:!0,progress:0,progressTotal:this.props.benchmarksets.length});for(let t=0;t<this.state.benchmarksets.length;t++)try{await this.setStatePromise({progress:t+1}),await this.onRunBenchmarkset(this.props.benchmarksets[t])}catch(e){console.error(e)}await this.setStatePromise({running:!1})},this.onBenchmarksetLoad=async e=>{await this.setStatePromise(t=>{let a=t.benchmarksets.filter(t=>t.name===e.name)[0];return Object.assign(a,e),t})},this.onRunBenchmarkset=async e=>{let t,a;await this.setStatePromise(t=>{return t.benchmarksets.filter(t=>t.name===e.name)[0].running=!0,t});try{t=await N(e,this.onBenchmarksetLoad)}catch(s){a=s}return await this.setStatePromise(s=>{let r=s.benchmarksets.filter(t=>t.name===e.name)[0];return r.running=!1,t?(r.chart.xaxis.categories=t.categories,r.series=t.series,r.chart.colors=t.colors):r.error=a||"Unknown error",r.canvas=null,s}),t},this.state={running:!1,progress:0,progressTotal:0,benchmarksets:e.benchmarksets}}render(){return r.a.createElement(c.a,null,r.a.createElement(h.a,{hidden:!0}),r.a.createElement(d.a,{as:"h1",floated:"left"},"Benchmark-Sets"),r.a.createElement(m.a,{circular:!0,color:"teal",icon:"play circle",content:"Run all benchmarks",floated:"right",loading:this.state.running,onClick:this.onRunAllBenchmarksets,disabled:this.state.running||this.state.benchmarksets.some(e=>e.running)}),this.state.running&&this.state.progressTotal?r.a.createElement("div",{style:{clear:"both"}},r.a.createElement(p.a,{value:this.state.progress,total:this.state.progressTotal,progress:"ratio"})):null,r.a.createElement("div",{style:{clear:"both"}},this.state.benchmarksets.map(e=>r.a.createElement(ae,Object.assign({key:e.name},e,{someRunning:this.state.running||this.state.benchmarksets.some(e=>e.running),onRun:this.onRunBenchmarkset})))),r.a.createElement(h.a,{hidden:!0}))}}var re=se;class ne extends s.Component{constructor(e){super(e),window.wasm={},this.state={loading:!0,error:!1}}componentDidMount(){Promise.all([a.e(3).then(a.bind(null,356))]).then(e=>{window.wasm.rust=e[0],this.setState({loading:!1})}).catch(e=>this.setState({error:e.message}))}render(){return this.state.error?r.a.createElement(Y.a,{error:!0},"Could not start application: ",this.state.error):this.state.loading?r.a.createElement("div",null,"Loading..."):r.a.createElement("main",null,r.a.createElement(i.a,null,r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"/",render:()=>r.a.createElement(re,{benchmarksets:K.benchmarksets})}),r.a.createElement(l.a,{path:"/test/:id",component:ae}))))}}var oe=ne;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(340),a(341);o.a.render(r.a.createElement(oe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})},89:function(e,t){}},[[192,1,2]]]);
//# sourceMappingURL=main.388cb608.chunk.js.map